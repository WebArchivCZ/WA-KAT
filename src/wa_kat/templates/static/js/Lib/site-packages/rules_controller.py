#! /usr/bin/env python
# -*- coding: utf-8 -*-
#
# Interpreter version: python 2.7
#
# Imports =====================================================================
from browser import document


# Functions & classes =========================================================
class RadioDescriptor(object):
    def __init__(self, name, val_type=bool):
        self.name = name
        self.type = val_type

        self.elements = [
            el
            for el in document.get(selector="input[name='%s']" % name)
        ]
        self.values = {self._get_right_type(el.value) for el in self.elements}

    def _get_right_type(self, val):
        if self.type == bool:
            return val.lower() == "true"

        return self.type(val)

    def __get__(self, obj, objtype):
        for el in self.elements:
            if el.checked:
                return self._get_right_type(el.value)

        return None

    def __set__(self, obj, value):
        def _normalize(val):
            return str(val).lower()

        for el in self.elements:
            if _normalize(el.value) == _normalize(value):
                el.checked = True
                return

        raise ValueError(
            "Can't set the `%s` to `%s`." % (str(el), repr(value))
        )


class RulesView(object):
    budget = RadioDescriptor("budget_radio", val_type=int)
    gentle_fetch = RadioDescriptor("gentle_fetch_radio", val_type=str)
    local_traps = RadioDescriptor("local_traps_radio")
    calendars = RadioDescriptor("calendars_radio")
    youtube = RadioDescriptor("youtube_radio")
    global_reject = RadioDescriptor("global_reject_radio")
    javascript = RadioDescriptor("javascript_radio")

    def __init__(self):
        self._property_names = [
            "budget",
            "gentle_fetch",
            "local_traps",
            "calendars",
            "youtube",
            "global_reject",
            "javascript",
        ]

    def get_dict(self):
        return {
            property_name: getattr(self, property_name)
            for property_name in self._property_names
        }

    def set_dict(self, incomming):
        for key, val in incomming:
            if key in self._property_names:
                setattr(self, key, val)
